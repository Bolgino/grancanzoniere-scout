<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GranCanzoniere Scout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icona.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="dynamic-background">
        <div id="night-sky" class="sky-layer">
            <div class="night-core-bg"></div>
            <div id="night-stars-container"></div>

            <div class="constellation-wrapper" style="top: 10%; left: 50%; transform: translateX(-50%) rotate(15deg);">
                <svg width="220" height="220" viewBox="0 0 220 220">
                    <path class="constellation-path" d="M 110 20 L 110 180 M 40 100 L 180 100" />
                    <circle cx="110" cy="20" r="4" class="c-star main-star" /> 
                    <circle cx="110" cy="180" r="2.5" class="c-star" />
                    <circle cx="110" cy="100" r="2.5" class="c-star" /> <circle cx="40" cy="100" r="2.5" class="c-star" />
                    <circle cx="180" cy="100" r="2.5" class="c-star" />
                </svg>
                <div class="constellation-name">Cigno</div>
            </div>

            <div class="constellation-wrapper" style="top: 15%; right: 20%; transform: rotate(-20deg);">
                <svg width="100" height="120" viewBox="0 0 100 120">
                    <path class="constellation-path" d="M 50 10 L 25 40 L 75 40 L 50 10 M 25 40 L 20 90 L 80 90 L 75 40" />
                    <circle cx="50" cy="10" r="4.5" class="c-star main-star" />
                    <circle cx="25" cy="40" r="2" class="c-star" />
                    <circle cx="75" cy="40" r="2" class="c-star" />
                    <circle cx="20" cy="90" r="2" class="c-star" />
                    <circle cx="80" cy="90" r="2" class="c-star" />
                </svg>
                <div class="constellation-name">Lira</div>
            </div>

            <div class="constellation-wrapper" style="top: 40%; right: 10%; transform: rotate(10deg);">
                <svg width="160" height="100" viewBox="0 0 160 100">
                    <path class="constellation-path" d="M 10 20 L 40 80 L 80 40 L 120 70 L 150 20" />
                    <circle cx="10" cy="20" r="2.5" class="c-star" />
                    <circle cx="40" cy="80" r="2.5" class="c-star" />
                    <circle cx="80" cy="40" r="3" class="c-star" /> <circle cx="120" cy="70" r="2.5" class="c-star" />
                    <circle cx="150" cy="20" r="2.5" class="c-star" />
                </svg>
                <div class="constellation-name">Cassiopea</div>
            </div>

            <div class="constellation-wrapper" style="bottom: 15%; left: 5%;">
                <svg width="240" height="140" viewBox="0 0 240 140">
                    <path class="constellation-path" d="M 220 20 L 180 30 L 150 50 L 120 60 L 90 90 L 30 90 L 30 60 L 90 60" />
                    <circle cx="220" cy="20" r="2.5" class="c-star" />
                    <circle cx="180" cy="30" r="2.5" class="c-star" />
                    <circle cx="150" cy="50" r="2.5" class="c-star" />
                    <circle cx="120" cy="60" r="2.5" class="c-star" /> <circle cx="90" cy="90" r="2.5" class="c-star" />
                    <circle cx="30" cy="90" r="2.5" class="c-star" /> <circle cx="30" cy="60" r="2.5" class="c-star" /> <circle cx="90" cy="60" r="2.5" class="c-star" />
                </svg>
                <div class="constellation-name">Orsa Maggiore</div>
            </div>
        </div>
    </div>

    <div style="position: absolute; top: -9999px; left: -9999px;">
        <input type="text" name="fake_email_trap" tabindex="-1">
        <input type="password" name="fake_password_trap" tabindex="-1">
    </div>

    <div id="loadingOverlay">
        <div class="telescope-lens">
            <div class="lens-star" style="top: 20%; left: 30%; width: 2px; height: 2px; animation-delay: 0s;"></div>
            <div class="lens-star" style="top: 50%; left: 60%; width: 3px; height: 3px; animation-delay: 0.5s;"></div>
            <div class="lens-star" style="top: 70%; left: 20%; width: 2px; height: 2px; animation-delay: 1s;"></div>
            <div class="lens-star" style="top: 30%; left: 80%; width: 1px; height: 1px; animation-delay: 1.5s;"></div>
            <div class="lens-star" style="top: 80%; left: 70%; width: 2px; height: 2px; animation-delay: 0.2s;"></div>
        </div>
        <h5 id="loaderText" class="typing-cursor">Inizializzazione...</h5>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer" style="z-index: 1100"></div>

    <nav class="navbar navbar-dark fixed-top shadow-sm" style="background: rgba(13, 110, 253, 0.15); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 1040;">
        <div class="container-fluid">
            
            <span class="navbar-brand d-flex align-items-center gap-2" role="button" onclick="window.goHome()">
                <i class="bi bi-fire text-warning"></i> 
                <span class="star-title">GranCanzoniere</span>
            </span>

            <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center text-white-50 small bg-dark px-2 py-1 rounded-pill border border-secondary" style="white-space: nowrap;">
                    <i class="bi bi-music-note-beamed me-1"></i>
                    <span id="totalSongsCount" class="fw-bold text-white">...</span>
                </div>

                <button class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
        </div>
    </nav>

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="background-color: #1a1a1a; color: white;">
        
        <div class="offcanvas-header border-bottom border-secondary">
            <h5 class="offcanvas-title fw-bold text-primary" id="offcanvasNavbarLabel">
                <i class="bi bi-list"></i> Menu
            </h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>

       <div class="offcanvas-body d-flex flex-column p-4">
            
            <div class="d-flex flex-column gap-2">
                
                <button class="btn btn-dark text-start py-3 px-3 w-100 d-flex align-items-center rounded-3 border-0 shadow-sm" 
                        style="background-color: rgba(255,255,255,0.05);" 
                        onclick="window.goHome(); document.querySelector('.btn-close').click()">
                    <i class="bi bi-music-note-list text-primary fs-4 me-3"></i> 
                    <span class="fs-5">Canzoniere</span>
                </button>
        
        <button class="btn btn-outline-light text-start py-3 px-3 w-100 d-flex align-items-center rounded-3 border-secondary guest-only" 
                onclick="window.openProposeView(); document.querySelector('.btn-close').click()">
            <i class="bi bi-plus-lg fs-4 me-3"></i> 
            <span class="fs-5">Proponi Canzone</span>
        </button>

        <button class="btn btn-outline-warning text-start py-3 px-3 w-100 d-flex align-items-center rounded-3 border-secondary admin-only" 
                onclick="window.openProposeView(); document.querySelector('.btn-close').click()">
            <i class="bi bi-plus-circle-fill text-warning fs-4 me-3"></i> 
            <span class="fs-5 fw-bold text-warning">Aggiungi Canzone</span>
        </button>
        
                <button class="btn btn-outline-light text-start py-3 px-3 w-100 d-flex align-items-center rounded-3 border-secondary" 
                        onclick="window.openSetlistsView(); document.querySelector('.btn-close').click()">
                    <i class="bi bi-list-check text-info fs-4 me-3"></i> 
                    <span class="fs-5">Scalette</span>
                </button>
        
            </div>
        
            <div class="admin-only mt-4 pt-3 border-top border-secondary">
                <h6 class="text-muted text-uppercase fw-bold mb-3 ps-1" style="letter-spacing: 1px; font-size: 0.8rem;">Area Capi</h6>
                
                <div class="d-flex flex-column gap-2">
                    <button class="btn btn-link text-warning text-decoration-none text-start p-2 d-flex align-items-center" 
                            onclick="window.openProposalsView(); document.querySelector('.btn-close').click()">
                        <i class="bi bi-inbox-fill me-3 fs-5"></i> Revisiona Proposte
                        <span class="badge rounded-pill bg-danger ms-auto" id="proposalsBadge" style="display:none">0</span>
                    </button>
        
                    <button class="btn btn-link text-white text-decoration-none text-start p-2 d-flex align-items-center" 
                            onclick="window.openManageSectionsView(); document.querySelector('.btn-close').click()">
                        <i class="bi bi-gear-wide-connected me-3 fs-5"></i> Gestione Sezioni
                    </button>
        
                    <button class="btn btn-link text-white text-decoration-none text-start p-2 d-flex align-items-center" 
                            onclick="window.openExportView(); document.querySelector('.btn-close').click()">
                        <i class="bi bi-printer-fill me-3 fs-5"></i> Export Canzoniere
                    </button>
        
                    <button class="btn btn-link text-white-50 text-decoration-none text-start p-2 d-flex align-items-center" 
                            onclick="new bootstrap.Modal(document.getElementById('infoImportModal')).show(); document.querySelector('.btn-close').click()">
                        <i class="bi bi-upload me-3 fs-5"></i> Importa TXT
                    </button>
                    <input type="file" id="txtImporter" style="display:none" accept=".txt" onchange="window.processTxtImport()">
                </div>
            </div>
        
            <div class="mt-auto pt-5">
                <button class="btn btn-outline-light w-100 mb-2 py-2 guest-only" id="btnLoginBtn" onclick="window.openLoginModal(); document.querySelector('.btn-close').click()">Accesso Capi</button>
                <button class="btn btn-outline-danger w-100 py-2 admin-only" onclick="window.logout()">Esci</button>
            </div>
        
        </div>
    </div>

    <div class="container mt-4">

        <div id="view-dashboard" class="view-screen active">
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <div class="input-group input-group-lg shadow-sm">
                        <span class="input-group-text border-secondary" style="background-color: #000; color: white;">
                            <i class="bi bi-search text-white"></i>
                        </span>
                        <input type="text" id="globalSearch" name="search_safe_scout" autocomplete="off" class="form-control border-0" placeholder="Cerca tra tutte le canzoni..." onkeyup="debouncedGlobalSearch()">
                        <button class="btn border-0" style="background-color: #2b2b2b; color: #888;" onclick="window.renderDashboard()"><i class="bi bi-x-lg"></i></button>
                    </div>
                </div>
            </div>

            <div id="dashboardContent">
                <div id="favoritesSection" style="display:none;" class="mb-4">
                    <h5 class="text-primary fw-bold"><i class="bi bi-star-fill text-warning"></i> I tuoi Preferiti</h5>
                    <div id="favoritesContainer" class="list-group shadow-sm mb-4"></div>
                </div>

                <h4 class="mb-4 text-secondary border-bottom pb-2">Sezioni</h4>
                <div id="categoriesContainer" class="row g-4"></div>
            </div>
        </div>

        <div id="view-export" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3 border-bottom border-secondary pb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()">
                    <i class="bi bi-arrow-left"></i> Home
                </button>
                <h3 class="fw-bold m-0 text-white"><i class="bi bi-printer"></i> Centro Stampe</h3>
                <div style="width: 80px;"></div>
            </div>
        
            <div class="row g-4 h-100">
                <div class="col-lg-5 mb-4">
                    <div class="card bg-dark border-secondary shadow sticky-top" style="top: 100px;">
                        <div class="card-header border-bottom border-secondary text-center text-muted text-uppercase small fw-bold">
                            <span id="previewHeaderTitle">Anteprima</span>
                        </div>
                        <div class="card-body p-4 d-flex justify-content-center align-items-center bg-secondary bg-opacity-10 position-relative" style="min-height: 400px; overflow: hidden;">
                            
                            <img id="exportPreviewImg" src="" class="img-fluid shadow-lg rounded" style="max-height: 350px; display: none;">
                            
                            <div id="exportPreviewPlaceholder" class="text-center text-muted">
                                <i class="bi bi-book fs-1 mb-2"></i><br>
                                <span class="small">Seleziona una sezione o carica una copertina<br>per vederla qui.</span>
                            </div>
        
                            <div id="formatPreviewContainer" class="w-100 h-100 d-none flex-column align-items-center justify-content-center p-2"></div>
        
                        </div>
                        <div class="card-footer border-top border-secondary text-center">
                            <small class="text-white-50" id="exportPreviewLabel">Nessuna selezione</small>
                        </div>
                    </div>
                </div>
        
                <div class="col-lg-7">
                    <div class="accordion" id="exportAccordion">
                        
                        <div class="accordion-item bg-dark border-secondary">
                            <h2 class="accordion-header">
                                <button class="accordion-button bg-dark text-white shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                    <i class="bi bi-sliders me-2 text-warning"></i> Configurazione Layout
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#exportAccordion">
                                <div class="accordion-body border-top border-secondary">
                                    <div class="row g-3">
                                        <div class="col-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="pdfTwoColumns" checked><label class="form-check-label text-white" for="pdfTwoColumns">Due colonne</label></div></div>
                                        <div class="col-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="pdfShowChords" checked><label class="form-check-label text-white" for="pdfShowChords">Includi Accordi</label></div></div>
                                        <div class="col-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="pdfShowToc" checked><label class="form-check-label text-white" for="pdfShowToc">Genera Indice</label></div></div>
                                        <div class="col-6"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="pdfShowPageNumbers" checked><label class="form-check-label text-white" for="pdfShowPageNumbers">Numeri Pagina</label></div></div>
                                        <div class="col-12"><label class="form-label text-white-50 small mb-1">Dimensione Testo</label><select class="form-select form-select-sm bg-dark text-white border-secondary" id="pdfFontSize"><option value="small">Compatto</option><option value="normal" selected>Normale</option><option value="large">Grande</option></select></div>
                                        <div class="col-12"><label class="form-label text-white-50 small">Copertina Generale</label><input class="form-control bg-secondary text-white border-0 form-control-sm" type="file" id="globalCoverInput" accept="image/*" onchange="window.updateExportPreview('global', this)"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="accordion-item bg-dark border-secondary">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed bg-dark text-white shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                    <i class="bi bi-collection-fill me-2 text-warning"></i> Configurazione Sezioni
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#exportAccordion">
                                <div class="accordion-body">
                                    <div class="alert alert-info py-2 small mb-2"><i class="bi bi-info-circle me-1"></i> Deseleziona per escludere. Trascina per ordinare.</div>
                                    <div id="sectionOrderListExport" class="d-grid gap-2"></div>
                                </div>
                            </div>
                        </div>
        
                        <div class="accordion-item bg-dark border-secondary">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed bg-dark text-white shadow-none" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree">
                                    <i class="bi bi-printer-fill me-2 text-success"></i> Stampa Finale
                                </button>
                            </h2>
                            <div id="collapseThree" class="accordion-collapse collapse" data-bs-parent="#exportAccordion">
                                <div class="accordion-body">
                                    <div class="d-grid gap-3">
                                        <button class="btn btn-success fw-bold py-3 text-start position-relative export-btn" 
                                                onmouseenter="window.showFormatPreview('pdf')" onmouseleave="window.resetFormatPreview()" onclick="window.generateFullPDF()">
                                            <div class="d-flex align-items-center"><i class="bi bi-file-earmark-pdf-fill fs-3 me-3"></i><div><div class="fw-bold">Stampa Canzoniere (PDF)</div><small class="opacity-75">Formato A5 libretto</small></div></div>
                                        </button>
        
                                        <button class="btn btn-outline-success text-start py-2 export-btn" 
                                                onmouseenter="window.showFormatPreview('excel')" onmouseleave="window.resetFormatPreview()" onclick="window.generateExcelList()">
                                            <i class="bi bi-file-earmark-spreadsheet me-2"></i> Esporta Excel (.csv)
                                        </button>
                                        
                                        <button class="btn btn-outline-light text-start py-2 export-btn" 
                                                onmouseenter="window.showFormatPreview('txt')" onmouseleave="window.resetFormatPreview()" onclick="window.generateFullTxtList()">
                                            <i class="bi bi-file-text me-2"></i> Lista Semplice (.txt)
                                        </button>
                                        
                                        <button class="btn btn-outline-light text-start py-2 export-btn" 
                                                onmouseenter="window.showFormatPreview('latex')" onmouseleave="window.resetFormatPreview()" onclick="window.generateFullLatex()">
                                            <i class="bi bi-file-code me-2"></i> Sorgente LaTeX (.tex)
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                    </div>
                </div>
            </div>
        </div>

        <div id="view-setlists" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.handleSetlistBack()">
                    <i class="bi bi-arrow-left"></i> Indietro
                </button>
                <h3 class="fw-bold m-0 text-info">Le mie Scalette</h3>
                <button class="btn btn-primary btn-sm" onclick="window.createNewSetlistPrompt()"><i class="bi bi-plus-lg"></i> Nuova</button>
            </div>
            
            <div id="setlistsContainer" class="list-group shadow-sm mb-4"></div>

            <div id="activeSetlistDetail" style="display:none;" class="card shadow-sm border-0">
                <div class="card-header bg-dark border-bottom border-secondary">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="m-0 fw-bold text-primary text-truncate" id="activeSetlistTitle" style="max-width: 60%;">Titolo Scaletta</h5>
                        
                        <div class="d-flex gap-2 setlist-controls">
                            <button class="btn btn-outline-danger btn-sm d-flex align-items-center" onclick="window.deleteActiveSetlist()">
                                <i class="bi bi-trash me-1"></i> Elimina
                            </button>
                            <button class="btn btn-success btn-sm d-flex align-items-center" onclick="window.openSetlistExportModal()">
                                <i class="bi bi-printer me-1"></i> PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-secondary bg-opacity-25 p-2 rounded mb-0 setlist-controls">
                        <button class="btn btn-light w-100 fw-bold text-dark" onclick="window.openSearchForSetlistModal()">
                            <i class="bi bi-search"></i> Aggiungi Canzone
                        </button>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <div id="setlistSongsContainer" class="list-group list-group-flush"></div>
                    <div class="p-3 text-center text-muted small" id="emptySetlistMsg">Nessuna canzone. Aggiungine una!</div>
                </div>
            </div>
        </div>

        <div id="view-propose" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()">
                    <i class="bi bi-arrow-left"></i> Home
                </button>
                <h4 class="fw-bold m-0 text-white">Nuova Proposta</h4>
                <button class="btn btn-primary btn-sm fw-bold" onclick="window.handleSongSubmission()">
                    Invia <i class="bi bi-send-fill ms-1"></i>
                </button>
            </div>

            <div class="row g-3 h-100">
                <div class="col-lg-5 col-md-6 d-flex flex-column gap-2" style="max-height: 80vh; overflow-y: auto;">
                    <div class="card bg-dark border-secondary p-3">
                        <h6 class="text-muted mb-3">Dati Canzone</h6>
                        <input type="text" id="propTitle" class="form-control mb-2" placeholder="Titolo (Obbligatorio)">
                        <input type="text" id="propAuthor" class="form-control mb-2" placeholder="Autore">
                        <select id="propCategory" class="form-select mb-2"></select>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="number" id="propYear" class="form-control" placeholder="Anno">
                            </div>
                            <div class="col-6">
                                <input type="text" id="propUser" class="form-control" placeholder="Il tuo nome *">
                            </div>
                        </div>
                        <input type="text" id="propDesc" class="form-control mt-2" placeholder="Nota (es. Lento)">
                    </div>

                    <div class="card bg-dark border-secondary p-3 flex-grow-1">
                        <h6 class="text-muted mb-2">Testo e Accordi</h6>
                        <small class="text-muted d-block mb-2" style="font-size: 0.8rem;">Usa il formato [Do] per gli accordi.</small>
                        <textarea id="propLyrics" class="form-control font-monospace border-0" 
                                  style="flex-grow: 1; min-height: 300px; resize: none; background: #222; color: #fff;" 
                                  placeholder="[Do] Scrivi qui il testo..." 
                                  oninput="window.renderProposePreview()"></textarea>
                    </div>
                </div>

                <div class="col-lg-7 col-md-6">
                    <div class="card bg-dark border-secondary h-100">
                        <div class="card-header border-bottom border-secondary d-flex justify-content-between">
                            <span class="text-white">Anteprima</span>
                            <span class="badge bg-secondary">Come apparirÃ </span>
                        </div>
                        <div class="card-body p-0" style="background: #121212; overflow: hidden;">
                            <div id="propPreviewArea" class="preview-area h-100 overflow-auto p-3" style="font-size: 16px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-propose" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()">
                    <i class="bi bi-arrow-left"></i> Home
                </button>
                <h4 class="fw-bold m-0 text-white">Nuova Proposta</h4>
                <button class="btn btn-primary btn-sm fw-bold" onclick="window.handleSongSubmission()">
                    Invia <i class="bi bi-send-fill ms-1"></i>
                </button>
            </div>

            <div class="row g-3 h-100">
                <div class="col-lg-5 col-md-6 d-flex flex-column gap-2" style="max-height: 80vh; overflow-y: auto;">
                    <div class="card bg-dark border-secondary p-3">
                        <h6 class="text-muted mb-3">Dati Canzone</h6>
                        <input type="text" id="propTitle" class="form-control mb-2" placeholder="Titolo (Obbligatorio)">
                        <input type="text" id="propAuthor" class="form-control mb-2" placeholder="Autore">
                        <select id="propCategory" class="form-select mb-2"></select>
                        <div class="row g-2">
                            <div class="col-6">
                                <input type="number" id="propYear" class="form-control" placeholder="Anno">
                            </div>
                            <div class="col-6">
                                <input type="text" id="propUser" class="form-control" placeholder="Il tuo nome *">
                            </div>
                        </div>
                        <input type="text" id="propDesc" class="form-control mt-2" placeholder="Nota (es. Lento)">
                    </div>

                    <div class="card bg-dark border-secondary p-3 flex-grow-1">
                        <h6 class="text-muted mb-2">Testo e Accordi</h6>
                        <small class="text-muted d-block mb-2" style="font-size: 0.8rem;">Usa il formato [Do] per gli accordi.</small>
                        <textarea id="propLyrics" class="form-control font-monospace border-0" 
                                  style="flex-grow: 1; min-height: 300px; resize: none; background: #222; color: #fff;" 
                                  placeholder="[Do] Scrivi qui il testo..." 
                                  oninput="window.renderProposePreview()"></textarea>
                    </div>
                </div>

                <div class="col-lg-7 col-md-6">
                    <div class="card bg-dark border-secondary h-100">
                        <div class="card-header border-bottom border-secondary d-flex justify-content-between">
                            <span class="text-white">Anteprima</span>
                            <span class="badge bg-secondary">Come apparirÃ </span>
                        </div>
                        <div class="card-body p-0" style="background: #121212; overflow: hidden;">
                            <div id="propPreviewArea" class="preview-area h-100 overflow-auto p-3" style="font-size: 16px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="view-list" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()"><i class="bi bi-arrow-left"></i> Sezioni</button>
                <h3 id="listTitle" class="fw-bold m-0 text-primary">Nome Sezione</h3>
                <div style="width: 80px;"></div>
            </div>
            <input type="text" id="sectionSearchBox" class="form-control mb-4 shadow-sm" placeholder="Filtra in questa sezione..." onkeyup="window.filterSectionList()">
            <div id="songListContainer" class="list-group shadow-sm"></div>
        </div>

        <div id="view-editor" class="view-screen">
            <div class="card shadow-sm mb-3 border-0">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    
                    <div class="d-flex align-items-center gap-2" style="flex: 1; min-width: 200px;">
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.goBackToList()"><i class="bi bi-arrow-left"></i></button>
                        <div> 
                            <h5 id="editorTitle" class="m-0 fw-bold text-wrap">Titolo</h5>
                            <small id="editorAuthor" class="text-muted text-wrap">Autore</small>
                            <div id="editorMeta" class="small text-secondary fst-italic text-wrap"></div>
                        </div>
                        <button class="btn btn-link text-warning p-0 ms-2" onclick="window.toggleFavorite()" title="Aggiungi ai preferiti">
                            <i class="bi bi-star" id="favIcon"></i>
                        </button>
                        <button class="btn btn-link text-info p-0 ms-2" onclick="window.openAddToSetlistModal()" title="Aggiungi a una Scaletta">
                            <i class="bi bi-plus-square-fill"></i>
                        </button>
                        <button class="btn btn-sm btn-light text-primary admin-only" onclick="window.openSongMetadataModal()" title="Modifica Titolo/Autore">
                            <i class="bi bi-pencil-fill"></i>
                        </button>
                    </div>

                    <div class="d-flex gap-2 align-items-center bg-light rounded p-1">
                        <button class="btn btn-sm btn-outline-dark fw-bold border-0 admin-only" onclick="window.insertFormatting('**')" title="Grassetto">B</button>
                        <button class="btn btn-sm btn-outline-dark fst-italic border-0 admin-only" onclick="window.insertFormatting('__')" title="Corsivo">I</button>
                            
                        <div class="vr"></div>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="window.adjustFontSize(-2)">A-</button>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="window.adjustFontSize(2)">A+</button>
                        <div class="vr"></div>
                        <button class="btn btn-outline-primary btn-sm" onclick="window.changeTone(-1)">b</button>
                        <span id="toneDisplay" class="fw-bold px-2">0</span>
                        <button class="btn btn-outline-primary btn-sm" onclick="window.changeTone(1)">#</button>
                    </div>

                    <div class="d-flex gap-2 align-items-center">
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.toggleChords()" title="Nascondi Accordi"><i class="bi bi-music-note-beamed"></i></button>
                        <button class="btn btn-outline-success btn-sm" id="btnAutoScroll" onclick="window.toggleAutoScroll()" title="Auto-Scroll">
                            <i class="bi bi-mouse3"></i>
                        </button>
                        <button class="btn btn-success btn-sm admin-only fw-bold" onclick="window.saveSong()">
                            <i class="bi bi-save"></i> Salva
                        </button>
                        
                        <button class="btn btn-danger btn-sm admin-only" onclick="window.deleteCurrentSong()" title="Elimina Canzone">
                            <i class="bi bi-trash"></i>
                        </button>
                        
                        <div class="dropdown admin-only">
                            <button class="btn btn-dark btn-sm dropdown-toggle" data-bs-toggle="dropdown">Export</button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" onclick="window.exportSinglePDF()">ðŸ“„ PDF Canzone (A5)</a></li>
                                <li><a class="dropdown-item" href="#" onclick="window.exportSingleLatex()">ðŸ“œ LaTeX Canzone</a></li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row h-100">
                <div class="col-md-5 mb-3 admin-block" style="display:none;">
                    <textarea id="lyricsEditor" class="form-control h-100 shadow-sm border-0" style="min-height: 500px; resize: none; font-family: monospace;" placeholder="Formato: [Do]Testo della canzone..." oninput="window.renderPreview()"></textarea>
                </div>
                <div class="col-md-12" id="previewContainerCol">
                    <div id="previewArea" class="preview-area h-100 overflow-auto"></div>
                </div>
            </div>
        </div>

        <div id="view-proposals" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()"><i class="bi bi-arrow-left"></i> Home</button>
                <h3 class="fw-bold m-0 text-warning">Revisione Proposte</h3>
                <div style="width: 80px;"></div>
            </div>
            <div id="proposalsContainer" class="list-group shadow-sm"></div>
        </div>

        <div id="view-manage-sections" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3 pb-2 border-bottom border-secondary">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()">
                    <i class="bi bi-arrow-left"></i> Home
                </button>
                
                <h3 class="fw-bold m-0 text-white">Gestione Sezioni</h3>
                
                <button class="btn btn-primary btn-sm shadow" onclick="window.openAddSectionModal()">
                    <i class="bi bi-plus-lg"></i> Nuova
                </button>
            </div>
            <div id="manageSectionsContainer" class="d-flex flex-column gap-2"></div>
        </div>

    </div> <div class="modal fade" id="confirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white"><h5 class="modal-title">Attenzione</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><p id="confirmMessage">Sei sicuro?</p></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-danger" id="confirmBtnAction">Conferma</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Accesso Capi</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="email" id="loginEmail" class="form-control mb-2" placeholder="Email">
                    <input type="password" id="loginPass" class="form-control mb-2" placeholder="Password">
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-primary w-100" onclick="window.performLogin()">Accedi</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addSongModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addSongTitle">Proponi Canzone</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row g-2">
                        <div class="col-md-6"><label class="form-label">Titolo *</label><input type="text" id="newSongTitle" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">Autore</label><input type="text" id="newSongAuthor" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">Sezione *</label><select id="newSongCategorySelect" class="form-select"></select></div>
                        <div class="col-md-6"><label class="form-label">Anno</label><input type="number" id="newSongYear" class="form-control" placeholder="es. 1995"></div>
                        <div class="col-12"><label class="form-label">Breve Descrizione (nota sotto al titolo)</label><input type="text" id="newSongDescription" class="form-control" placeholder="es. Lento e solenne"></div>
                        <div class="col-md-6" id="proposerField"><label class="form-label">Il tuo nome *</label><input type="text" id="newSongProposer" class="form-control" placeholder="Obbligatorio"></div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">Testo e Accordi (Opzionale)</label>
                        <textarea id="newSongLyrics" class="form-control font-monospace" rows="10" placeholder="[Do]Respiri piano... (Puoi lasciare vuoto se non lo sai)"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" onclick="window.handleSongSubmission()" id="btnSubmitSong">Invia</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="reviewProposalModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark border-secondary">
                    <h5 class="modal-title fw-bold"><i class="bi bi-pencil-square"></i> Revisiona Proposta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="row g-0 h-100">
                        <div class="col-lg-6 p-3 border-end border-secondary d-flex flex-column" style="background: #222;">
                            
                            <div class="row g-2 mb-3">
                                <div class="col-md-6">
                                    <label class="small text-muted">Titolo</label>
                                    <input type="text" id="reviewTitle" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted">Autore</label>
                                    <input type="text" id="reviewAuthor" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-6">
                                    <label class="small text-muted">Sezione</label>
                                    <select id="reviewCategory" class="form-select form-select-sm"></select>
                                </div>
                                <div class="col-md-3">
                                    <label class="small text-muted">Anno</label>
                                    <input type="number" id="reviewYear" class="form-control form-control-sm">
                                </div>
                                 <div class="col-md-3">
                                    <label class="small text-muted">Proposto da</label>
                                    <input type="text" id="reviewProposer" class="form-control form-control-sm" readonly disabled>
                                </div>
                                <div class="col-12">
                                    <label class="small text-muted">Descrizione</label>
                                    <input type="text" id="reviewDesc" class="form-control form-control-sm">
                                </div>
                            </div>
    
                            <label class="small text-muted mb-1">Testo e Accordi (Modifica qui)</label>
                            <textarea id="reviewLyrics" class="form-control font-monospace border-0 flex-grow-1" 
                                      style="resize: none; background: #1a1a1a; color: #fff; min-height: 300px;" 
                                      oninput="window.renderReviewPreview()"></textarea>
                        </div>
    
                        <div class="col-lg-6 p-0 bg-dark d-flex flex-column">
                            <div class="p-2 border-bottom border-secondary bg-secondary bg-opacity-10 text-center">
                                <small class="text-uppercase fw-bold text-muted">Anteprima Finale</small>
                            </div>
                            <div id="reviewPreviewArea" class="preview-area h-100 overflow-auto p-3" style="font-size: 14px;"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-secondary justify-content-between">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Annulla (Torna alla lista)</button>
                    <button type="button" class="btn btn-success fw-bold px-4" onclick="window.saveAndApproveProposal()">
                        <i class="bi bi-check-lg"></i> SALVA E APPROVA
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="editSongMetadataModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modifica Dati</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="editSongTitleInput" class="form-control mb-2" placeholder="Titolo">
                    <input type="text" id="editSongAuthorInput" class="form-control mb-2" placeholder="Autore">
                    
                    <label class="form-label small text-muted mt-2">Sposta in altra sezione:</label>
                    <select id="editSongCategorySelect" class="form-select mb-2"></select>
                    <input type="number" id="editSongYearInput" class="form-control mb-2" placeholder="Anno">
                    <input type="text" id="editSongDescInput" class="form-control" placeholder="Breve Descrizione">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="window.saveSongMetadata()">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addSectionModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nuova Sezione</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nome Sezione *</label>
                        <input type="text" id="newSectionName" class="form-control" placeholder="Es. Fuoco di Bivacco">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Copertina (Opzionale)</label>
                        <input class="form-control" type="file" id="newSectionCoverInput" accept="image/*">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary" onclick="window.createNewSection()">Crea Sezione</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editSectionModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Impostazioni Sezione</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="editSectionNameInput" class="form-control mb-3" placeholder="Nome">
                    <label class="form-label">Copertina (File)</label>
                    <input class="form-control" type="file" id="coverFileInput" accept="image/*" onchange="window.previewCoverFile()">
                    <div class="mt-2 text-center">
                        <img id="coverPreviewImg" src="" style="max-height:100px;display:none;border-radius:8px">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary" onclick="window.saveSectionSettings()">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addToSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h6 class="modal-title">Aggiungi a...</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-2">
                    <div id="setlistSelectorContainer" class="list-group list-group-flush"></div>
                    <button class="btn btn-outline-primary btn-sm w-100 mt-2" onclick="window.createNewSetlistFromModal()">+ Nuova Scaletta</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="searchForSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Aggiungi alla scaletta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchSetlistInput" class="form-control mb-3" placeholder="Cerca titolo..." onkeyup="window.performSetlistSearch()">
                    <div id="searchSetlistResults" class="list-group" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exportSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stampa Scaletta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3 text-center">
                        <label class="form-label text-muted small">Carica una copertina opzionale per questa scaletta</label>
                        <input class="form-control form-control-sm" type="file" id="setlistCoverInputModal" accept="image/*">
                    </div>
                    
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="setlistTwoColumns" checked>
                                <label class="form-check-label" for="setlistTwoColumns">Due colonne</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="setlistShowChords" checked>
                                <label class="form-check-label" for="setlistShowChords">Includi Accordi</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="setlistShowToc">
                                <label class="form-check-label" for="setlistShowToc">Genera Indice</label>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="setlistShowPageNumbers" checked>
                                <label class="form-check-label" for="setlistShowPageNumbers">Numeri Pagina</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <label class="form-label small text-muted mb-1">Dimensione Testo</label>
                            <select class="form-select form-select-sm" id="setlistFontSize">
                                <option value="small">Compatto (Testo 9pt)</option>
                                <option value="normal" selected>Normale (Testo 10pt)</option>
                                <option value="large">Grande (Testo 12pt)</option>
                            </select>
                        </div>
                    </div>
    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary fw-bold" onclick="window.confirmSetlistPDF()">
                        <i class="bi bi-printer-fill me-2"></i> Crea PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="infoImportModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-secondary bg-dark text-white">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-info-circle text-info me-2"></i>Istruzioni Importazione</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="small text-muted mb-3">
                        Per importare correttamente le canzoni, il tuo file <strong>.txt</strong> deve seguire rigorosamente questo formato:
                    </p>
                    
                    <div class="bg-black p-3 rounded border border-secondary mb-3" style="font-family: monospace; font-size: 0.85rem; color: #00ff00;">
                        SEZIONE: Fuoco di Bivacco<br>
                        1. Albachiara - Autore: Vasco<br>
                        2. La Canzone del Sole<br>
                        <br>
                        SEZIONE: Liturgia<br>
                        3. Symbolum 77
                    </div>
    
                    <ul class="small text-white-50 mb-0">
                        <li>Scrivi <strong>SEZIONE:</strong> seguito dal nome per creare una categoria.</li>
                        <li>Ogni canzone deve iniziare con un <strong>numero e un punto</strong> (es. "1. ").</li>
                        <li>Opzionale: aggiungi " - Autore: Nome" alla fine della riga.</li>
                    </ul>
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-outline-light btn-sm" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-success btn-sm fw-bold" onclick="document.getElementById('txtImporter').click()">
                        <i class="bi bi-upload me-2"></i> Scegli File .txt
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="createSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: #2b2b2b; color: white; border: 1px solid #444;">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-folder-plus text-primary"></i> Nuova Scaletta</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label text-muted small">Nome della scaletta (es. "Fuoco 2024")</label>
                    <input type="text" id="newSetlistNameInput" class="form-control bg-dark text-white border-secondary" placeholder="Inserisci nome...">
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-link text-decoration-none text-muted" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary px-4 rounded-pill" onclick="window.confirmCreateSetlist()">Crea Scaletta</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exportOptionsModal" tabindex="-1">
         <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                     <h5 class="modal-title">Opzioni Esportazione</h5>
                     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                     <div id="sectionOrderList"></div>
                </div>
            </div>
         </div>
    </div>
    <div class="modal fade" id="duplicateWarningModal" tabindex="-1" data-bs-backdrop="static">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-warning">
                <div class="modal-header bg-warning text-dark border-bottom border-dark">
                    <h5 class="modal-title fw-bold"><i class="bi bi-exclamation-triangle-fill me-2"></i>Canzone giÃ  presente!</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-dark text-white">
                    <p>Hai inserito il titolo <strong>"<span id="dupSongTitle"></span>"</strong>.</p>
                    <div class="alert alert-secondary text-white border-secondary bg-opacity-25">
                        Esiste giÃ  una canzone simile nel database:<br>
                        <strong class="text-warning" id="dupDbTitle"></strong> <span class="small text-muted" id="dupDbAuth"></span>
                    </div>
                    <p class="mb-0">La canzone esistente Ã¨ vuota (senza testo).<br>Vuoi <strong>UNIRE</strong> i dati e inserire il testo che hai appena scritto in quella vecchia?</p>
                </div>
                <div class="modal-footer bg-dark border-top border-secondary justify-content-between">
                    <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-warning fw-bold" onclick="window.executeMerge()">
                        <i class="bi bi-file-earmark-arrow-up-fill me-2"></i>SÃ¬, Unisci e Salva
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="script.js?v=2"></script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
          .then(() => console.log("Service Worker Registrato!"))
          .catch((err) => console.log("Errore SW:", err));
      }
    </script>
</body>
</html>














