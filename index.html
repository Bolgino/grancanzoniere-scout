<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GranCanzoniere Scout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="icona.ico" type="image/x-icon">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d6efd">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div id="dynamic-background">
        <div id="night-sky" class="sky-layer">
            <div class="night-core-bg"></div>
            <div id="night-stars-container"></div>

            <div class="constellation-wrapper" style="top: 15%; right: 25%; transform: rotate(-10deg);">
                <svg width="220" height="220" viewBox="0 0 220 220">
                    <path class="constellation-path" d="M 110 20 L 110 180 M 40 100 L 180 100" />
                    <circle cx="110" cy="20" r="3" class="c-star main-star" />
                    <circle cx="110" cy="180" r="2.5" class="c-star" />
                    <circle cx="110" cy="100" r="2.5" class="c-star" />
                    <circle cx="40" cy="100" r="2.5" class="c-star" />
                    <circle cx="180" cy="100" r="2.5" class="c-star" />
                </svg>
                <div class="constellation-name">Cigno</div>
            </div>

        <div class="constellation-wrapper" style="bottom: 25%; left: 10%;">
            <svg width="240" height="140" viewBox="0 0 240 140">
                <path class="constellation-path" d="M 220 20 L 180 30 L 150 50 L 120 60 L 90 90 L 30 90 L 30 60 L 90 60" />
                <circle cx="220" cy="20" r="2.5" class="c-star" />
                <circle cx="180" cy="30" r="2.5" class="c-star" />
                <circle cx="150" cy="50" r="2.5" class="c-star" />
                <circle cx="120" cy="60" r="2.5" class="c-star" />
                <circle cx="90" cy="90" r="2.5" class="c-star" />
                <circle cx="30" cy="90" r="2.5" class="c-star" />
                <circle cx="30" cy="60" r="2.5" class="c-star" />
                <circle cx="90" cy="60" r="2.5" class="c-star" />
            </svg>
            <div class="constellation-name">Orsa Maggiore</div>
        </div>

        <div class="constellation-wrapper" style="top: 10%; left: 15%;">
            <svg width="150" height="100" viewBox="0 0 150 100">
                <path class="constellation-path" d="M 20 20 L 50 30 L 70 50 L 100 50 L 130 70 L 130 40 L 100 40 L 100 50" />
                <circle cx="20" cy="20" r="4" class="c-star main-star" /> <circle cx="50" cy="30" r="2" class="c-star" />
                <circle cx="70" cy="50" r="2" class="c-star" />
                <circle cx="100" cy="50" r="2" class="c-star" />
                <circle cx="130" cy="70" r="2" class="c-star" />
                <circle cx="130" cy="40" r="2" class="c-star" />
                <circle cx="100" cy="40" r="2" class="c-star" />
            </svg>
            <div class="constellation-name">Orsa Minore</div>
        </div>

        <div class="constellation-wrapper" style="bottom: 15%; right: 15%;">
            <svg width="150" height="200" viewBox="0 0 150 200">
                <path class="constellation-path" d="M 30 30 L 120 40 M 30 170 L 120 160 M 60 95 L 90 105 L 75 100 L 60 95" />
                <circle cx="30" cy="30" r="3.5" class="c-star main-star" /> <circle cx="120" cy="40" r="3" class="c-star" /> <circle cx="60" cy="95" r="2" class="c-star" /> <circle cx="75" cy="100" r="2" class="c-star" /> <circle cx="90" cy="105" r="2" class="c-star" /> <circle cx="120" cy="160" r="4" class="c-star main-star" /> <circle cx="30" cy="170" r="3" class="c-star" /> </svg>
            <div class="constellation-name">Orione</div>
        </div>
    </div>
</div>

    <div style="position: absolute; top: -9999px; left: -9999px;">
        <input type="text" name="fake_email_trap" tabindex="-1">
        <input type="password" name="fake_password_trap" tabindex="-1">
    </div>
<div id="loadingOverlay">
    <div class="telescope-lens">
        <div class="lens-star" style="top: 20%; left: 30%; width: 2px; height: 2px; animation-delay: 0s;"></div>
        <div class="lens-star" style="top: 50%; left: 60%; width: 3px; height: 3px; animation-delay: 0.5s;"></div>
        <div class="lens-star" style="top: 70%; left: 20%; width: 2px; height: 2px; animation-delay: 1s;"></div>
        <div class="lens-star" style="top: 30%; left: 80%; width: 1px; height: 1px; animation-delay: 1.5s;"></div>
        <div class="lens-star" style="top: 80%; left: 70%; width: 2px; height: 2px; animation-delay: 0.2s;"></div>
    </div>

    <h5 id="loaderText" class="typing-cursor">Inizializzazione...</h5>
</div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3" id="toastContainer" style="z-index: 1100"></div>

    <nav class="navbar navbar-dark fixed-top shadow-sm" style="background: rgba(13, 110, 253, 0.15); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 1040;">
        <div class="container-fluid">
            
            <span class="navbar-brand d-flex align-items-center gap-2" role="button" onclick="window.goHome()">
                <i class="bi bi-fire text-warning"></i> 
                <span class="star-title">GranCanzoniere</span>
            </span>

            <div class="d-flex align-items-center gap-3">
                
                <div class="d-flex align-items-center text-white-50 small bg-dark px-2 py-1 rounded-pill border border-secondary" style="white-space: nowrap;">
                    <i class="bi bi-music-note-beamed me-1"></i>
                    <span id="totalSongsCount" class="fw-bold text-white">...</span>
                </div>

                <button class="navbar-toggler border-0" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel" style="background-color: #1a1a1a; color: white;">
                
                <div class="offcanvas-header border-bottom border-secondary">
                    <h5 class="offcanvas-title fw-bold text-primary" id="offcanvasNavbarLabel">
                        <i class="bi bi-list"></i> Menu
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>

                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        
                        <li class="nav-item mb-2">
                            <button class="btn btn-link nav-link text-white text-decoration-none w-100 text-start fs-5" onclick="window.openSetlistsView(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-list-check text-info me-2"></i> Le mie Scalette
                            </button>
                        </li>

                        <li class="nav-item mb-4">
                            <button class="btn btn-primary btn-sm rounded-pill px-4 fw-bold w-100 py-2" onclick="window.showAddModal(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-plus-lg"></i> <span id="btnAddText">Proponi Canzone</span>
                            </button>
                        </li>

                        <li class="nav-item admin-only mt-2 pt-2 border-top border-secondary">
                            <small class="text-muted text-uppercase fw-bold mb-3 d-block ps-2">Strumenti Capo</small>
                            
                            <button class="btn btn-link nav-link text-warning text-decoration-none w-100 text-start py-2" onclick="window.openProposalsView(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-inbox-fill me-2"></i> Revisiona Proposte
                                <span class="badge rounded-pill bg-danger ms-2" id="proposalsBadge" style="display:none">0</span>
                            </button>

                            <button class="btn btn-link nav-link text-white text-decoration-none w-100 text-start py-2" onclick="window.showAddSectionModal(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-folder-plus me-2"></i> Nuova Sezione
                            </button>

                            <button class="btn btn-link nav-link text-white text-decoration-none w-100 text-start py-2" onclick="window.openExportModal(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-file-earmark-arrow-down me-2"></i> Export / Stampa
                            </button>

                            <input type="file" id="txtImporter" style="display:none" accept=".txt" onchange="window.processTxtImport()">
                            <button class="btn btn-link nav-link text-white text-decoration-none w-100 text-start py-2" onclick="document.getElementById('txtImporter').click(); document.querySelector('.btn-close').click()">
                                <i class="bi bi-upload me-2"></i> Importa da TXT
                            </button>
                        </li>

                        <li class="nav-item mt-5 pt-3 border-top border-secondary">
                            <button class="btn btn-outline-light btn-sm w-100 mb-3" id="btnLoginBtn" onclick="window.openLoginModal(); document.querySelector('.btn-close').click()">Accesso Capi</button>
                            <button class="btn btn-outline-danger btn-sm w-100 admin-only" onclick="window.logout()">Esci</button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">

        <div id="view-dashboard" class="view-screen active">
            <div class="row justify-content-center mb-4">
                <div class="col-md-8">
                    <div class="input-group input-group-lg shadow-sm">
                        <span class="input-group-text border-secondary" style="background-color: #000; color: white;">
                            <i class="bi bi-search text-white"></i>
                        </span>
                        <input type="text" id="globalSearch" name="search_safe_scout" autocomplete="off" class="form-control border-0" placeholder="Cerca tra tutte le canzoni..." onkeyup="debouncedGlobalSearch()">
                        <button class="btn border-0" style="background-color: #2b2b2b; color: #888;" onclick="window.renderDashboard()"><i class="bi bi-x-lg"></i></button>
                    </div>
                </div>
            </div>

            <div id="dashboardContent">
                <div id="favoritesSection" style="display:none;" class="mb-4">
                    <h5 class="text-primary fw-bold"><i class="bi bi-star-fill text-warning"></i> I tuoi Preferiti</h5>
                    <div id="favoritesContainer" class="list-group shadow-sm mb-4"></div>
                </div>

                <h4 class="mb-4 text-secondary border-bottom pb-2">Sezioni</h4>
                <div id="categoriesContainer" class="row g-4"></div>
                
            </div>
        </div>
        <div id="view-setlists" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.handleSetlistBack()">
                    <i class="bi bi-arrow-left"></i> Indietro
                </button>
                <h3 class="fw-bold m-0 text-info">Le mie Scalette</h3>
                <button class="btn btn-primary btn-sm" onclick="window.createNewSetlistPrompt()"><i class="bi bi-plus-lg"></i> Nuova</button>
            </div>
            
            <div id="setlistsContainer" class="list-group shadow-sm mb-4"></div>

            <div id="activeSetlistDetail" style="display:none;" class="card shadow-sm border-0">
                <div class="card-header">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h5 class="m-0 fw-bold text-primary" id="activeSetlistTitle">Titolo Scaletta</h5>
                        <div>
                            <button class="btn btn-outline-danger btn-sm" onclick="window.deleteActiveSetlist()"><i class="bi bi-trash"></i></button>
                            <button class="btn btn-success btn-sm ms-1" onclick="window.openSetlistExportModal()"><i class="bi bi-file-pdf"></i> Stampa A5</button>
                        </div>
                    </div>
                    
                    <div class="bg-light p-2 rounded mb-2">
                        <button class="btn btn-outline-primary btn-sm w-100" onclick="window.openSearchForSetlistModal()">
                            <i class="bi bi-search"></i> Aggiungi Canzone
                        </button>
                    </div>
                </div>
                
                <div class="card-body p-0">
                    <div id="setlistSongsContainer" class="list-group list-group-flush"></div>
                    <div class="p-3 text-center text-muted small" id="emptySetlistMsg">Nessuna canzone. Aggiungine una!</div>
                </div>
            </div>
        </div>

        <div id="view-list" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()"><i class="bi bi-arrow-left"></i> Sezioni</button>
                <h3 id="listTitle" class="fw-bold m-0 text-primary">Nome Sezione</h3>
                <div style="width: 80px;"></div>
            </div>
            <input type="text" id="sectionSearchBox" class="form-control mb-4 shadow-sm" placeholder="Filtra in questa sezione..." onkeyup="window.filterSectionList()">
            <div id="songListContainer" class="list-group shadow-sm"></div>
        </div>

        <div id="view-editor" class="view-screen">
            <div class="card shadow-sm mb-3 border-0">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    
                    <div class="d-flex align-items-center gap-2" style="flex: 1; min-width: 200px;">
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.goBackToList()"><i class="bi bi-arrow-left"></i></button>
                        <div> 
                            <h5 id="editorTitle" class="m-0 fw-bold text-wrap">Titolo</h5>
                            <small id="editorAuthor" class="text-muted text-wrap">Autore</small>
                            <div id="editorMeta" class="small text-secondary fst-italic text-wrap"></div>
                        </div>
                        <button class="btn btn-link text-warning p-0 ms-2" onclick="window.toggleFavorite()" title="Aggiungi ai preferiti">
                            <i class="bi bi-star" id="favIcon"></i>
                        </button>
                        <button class="btn btn-link text-info p-0 ms-2" onclick="window.openAddToSetlistModal()" title="Aggiungi a una Scaletta">
                            <i class="bi bi-plus-square-fill"></i>
                        </button>
                        <button class="btn btn-sm btn-light text-primary admin-only" onclick="window.openSongMetadataModal()" title="Modifica Titolo/Autore">
                            <i class="bi bi-pencil-fill"></i>
                        </button>
                    </div>

                    <div class="d-flex gap-2 align-items-center bg-light rounded p-1">
                        <button class="btn btn-sm btn-outline-dark fw-bold border-0 admin-only" onclick="window.insertFormatting('**')" title="Grassetto">B</button>
                        <button class="btn btn-sm btn-outline-dark fst-italic border-0 admin-only" onclick="window.insertFormatting('__')" title="Corsivo">I</button>
                            
                        <div class="vr"></div>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="window.adjustFontSize(-2)">A-</button>
                        <button class="btn btn-sm btn-outline-secondary border-0" onclick="window.adjustFontSize(2)">A+</button>
                        <div class="vr"></div>
                        <button class="btn btn-outline-primary btn-sm" onclick="window.changeTone(-1)">b</button>
                        <span id="toneDisplay" class="fw-bold px-2">0</span>
                        <button class="btn btn-outline-primary btn-sm" onclick="window.changeTone(1)">#</button>
                    </div>

                    <div class="d-flex gap-2 align-items-center">
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.toggleChords()" title="Nascondi Accordi"><i class="bi bi-music-note-beamed"></i></button>
                        <button class="btn btn-outline-success btn-sm" id="btnAutoScroll" onclick="window.toggleAutoScroll()" title="Auto-Scroll">
                            <i class="bi bi-mouse3"></i>
                        </button>
                        <button class="btn btn-success btn-sm admin-only fw-bold" onclick="window.saveSong()">
                            <i class="bi bi-save"></i> Salva
                        </button>
                        
                        <button class="btn btn-danger btn-sm admin-only" onclick="window.deleteCurrentSong()" title="Elimina Canzone">
                            <i class="bi bi-trash"></i>
                        </button>
                        
                        <div class="dropdown admin-only">
                            <button class="btn btn-dark btn-sm dropdown-toggle" data-bs-toggle="dropdown">Export</button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="#" onclick="window.exportSinglePDF()">ðŸ“„ PDF Canzone (A5)</a></li>
                                <li><a class="dropdown-item" href="#" onclick="window.exportSingleLatex()">LaTeX Canzone</a></li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>

            <div class="row h-100">
                <div class="col-md-5 mb-3 admin-block" style="display:none;">
                    <textarea id="lyricsEditor" class="form-control h-100 shadow-sm border-0" style="min-height: 500px; resize: none; font-family: monospace;" placeholder="Formato: [Do]Testo della canzone..." oninput="window.renderPreview()"></textarea>
                </div>
                <div class="col-md-12" id="previewContainerCol">
                    <div id="previewArea" class="preview-area h-100 overflow-auto"></div>
                </div>
            </div>
        </div>

        <div id="view-proposals" class="view-screen">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <button class="btn btn-outline-secondary btn-sm" onclick="window.goHome()"><i class="bi bi-arrow-left"></i> Home</button>
                <h3 class="fw-bold m-0 text-warning">Revisione Proposte</h3>
                <div style="width: 80px;"></div>
            </div>
            <div id="proposalsContainer" class="list-group shadow-sm"></div>
        </div>

    </div>

    <div class="modal fade" id="confirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white"><h5 class="modal-title">Attenzione</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div>
                <div class="modal-body"><p id="confirmMessage">Sei sicuro?</p></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-danger" id="confirmBtnAction">Conferma</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Accesso Capi</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <input type="email" id="loginEmail" class="form-control mb-2" placeholder="Email">
                    <input type="password" id="loginPass" class="form-control mb-2" placeholder="Password">
                </div>
                <div class="modal-footer"><button type="button" class="btn btn-primary w-100" onclick="window.performLogin()">Accedi</button></div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="addSongModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addSongTitle">Proponi Canzone</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-light border small" id="proposalInfo">
                        <i class="bi bi-info-circle"></i> La canzone verrÃ  revisionata dai capi prima di essere pubblicata.
                    </div>
                    <div class="row g-2">
                        <div class="col-md-6"><label class="form-label">Titolo *</label><input type="text" id="newSongTitle" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">Autore</label><input type="text" id="newSongAuthor" class="form-control"></div>
                        <div class="col-md-6"><label class="form-label">Sezione *</label><select id="newSongCategorySelect" class="form-select"></select></div>
                        <div class="col-md-6"><label class="form-label">Anno</label><input type="number" id="newSongYear" class="form-control" placeholder="es. 1995"></div>
                        <div class="col-12"><label class="form-label">Breve Descrizione (nota sotto al titolo)</label><input type="text" id="newSongDescription" class="form-control" placeholder="es. Lento e solenne"></div>
                        <div class="col-md-6" id="proposerField"><label class="form-label">Il tuo nome *</label><input type="text" id="newSongProposer" class="form-control" placeholder="Obbligatorio"></div>
                    </div>
                    <div class="mt-3">
                        <label class="form-label">Testo e Accordi (Opzionale)</label>
                        <textarea id="newSongLyrics" class="form-control font-monospace" rows="10" placeholder="[Do]Respiri piano... (Puoi lasciare vuoto se non lo sai)"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary w-100" onclick="window.handleSongSubmission()" id="btnSubmitSong">Invia</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="exportOptionsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header"><h5 class="modal-title">Export Completo</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="pdfTwoColumns" checked>
                        <label class="form-check-label" for="pdfTwoColumns fw-bold">Stampa su due colonne</label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="pdfShowChords" checked>
                        <label class="form-check-label fw-bold" for="pdfShowChords">Includi Accordi nel PDF</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Copertina Generale (Opzionale)</label>
                        <input class="form-control" type="file" id="globalCoverInput" accept="image/*">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Ordine Sezioni (Usa le frecce)</label>
                        <div id="sectionOrderList" class="list-group"></div>
                    </div>
                </div>
                <div class="modal-footer flex-column align-items-stretch gap-2">
                    <button type="button" class="btn btn-outline-danger w-100" onclick="window.generateFullPDF()"><i class="bi bi-file-pdf"></i> Genera PDF (A5)</button>
                    <div class="d-flex gap-2">
                        <button type="button" class="btn btn-outline-primary flex-grow-1" onclick="window.generateFullTxtList()"><i class="bi bi-file-text"></i> Lista TXT (No Testo)</button>
                        <button type="button" class="btn btn-outline-dark flex-grow-1" onclick="window.generateFullLatex()"><i class="bi bi-code-slash"></i> LaTeX</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editSongMetadataModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Modifica Dati</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="editSongTitleInput" class="form-control mb-2" placeholder="Titolo">
                    <input type="text" id="editSongAuthorInput" class="form-control mb-2" placeholder="Autore">
                    
                    <label class="form-label small text-muted mt-2">Sposta in altra sezione:</label>
                    <select id="editSongCategorySelect" class="form-select mb-2"></select>
                    <input type="number" id="editSongYearInput" class="form-control mb-2" placeholder="Anno">
                    <input type="text" id="editSongDescInput" class="form-control" placeholder="Breve Descrizione">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="window.saveSongMetadata()">Salva</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addSectionModal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Nuova Sezione</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="text" id="newSectionName" class="form-control" placeholder="Nome"></div><div class="modal-footer"><button type="button" class="btn btn-primary" onclick="window.createNewSection()">Crea</button></div></div></div></div>
    <div class="modal fade" id="editSectionModal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5 class="modal-title">Impostazioni Sezione</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="text" id="editSectionNameInput" class="form-control mb-3" placeholder="Nome"><label class="form-label">Copertina (File)</label><input class="form-control" type="file" id="coverFileInput" accept="image/*" onchange="window.previewCoverFile()"><div class="mt-2 text-center"><img id="coverPreviewImg" src="" style="max-height:100px;display:none;border-radius:8px"></div></div><div class="modal-footer justify-content-between"><button class="btn btn-danger" onclick="window.triggerDeleteSection()">Elimina</button><button class="btn btn-primary" onclick="window.saveSectionSettings()">Salva</button></div></div></div></div>
    <div class="modal fade" id="addToSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-sm">
            <div class="modal-content">
                <div class="modal-header"><h6 class="modal-title">Aggiungi a...</h6><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
                <div class="modal-body p-2">
                    <div id="setlistSelectorContainer" class="list-group list-group-flush"></div>
                    <button class="btn btn-outline-primary btn-sm w-100 mt-2" onclick="window.createNewSetlistFromModal()">+ Nuova Scaletta</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="searchForSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Aggiungi alla scaletta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" id="searchSetlistInput" class="form-control mb-3" placeholder="Cerca titolo..." onkeyup="window.performSetlistSearch()">
                    <div id="searchSetlistResults" class="list-group" style="max-height: 300px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="exportSetlistModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Stampa Scaletta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="setlistTwoColumns" checked>
                        <label class="form-check-label" for="setlistTwoColumns">Stampa su due colonne</label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="setlistShowChords" checked>
                        <label class="form-check-label fw-bold" for="setlistShowChords">Includi Accordi nel PDF</label>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Copertina Personalizzata</label>
                        <input type="file" id="setlistCoverInputModal" class="form-control" accept="image/*">
                        <small class="text-muted">Lascia vuoto per usare la copertina standard.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success w-100" onclick="window.confirmSetlistPDF()">
                        <i class="bi bi-printer"></i> Genera PDF
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="createSetlistModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="background-color: #2b2b2b; color: white; border: 1px solid #444;">
                <div class="modal-header border-secondary">
                    <h5 class="modal-title"><i class="bi bi-folder-plus text-primary"></i> Nuova Scaletta</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <label class="form-label text-muted small">Nome della scaletta (es. "Fuoco 2024")</label>
                    <input type="text" id="newSetlistNameInput" class="form-control bg-dark text-white border-secondary" placeholder="Inserisci nome...">
                </div>
                <div class="modal-footer border-secondary">
                    <button type="button" class="btn btn-link text-decoration-none text-muted" data-bs-dismiss="modal">Annulla</button>
                    <button type="button" class="btn btn-primary px-4 rounded-pill" onclick="window.confirmCreateSetlist()">Crea Scaletta</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="script.js?v=2"></script>
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js')
          .then(() => console.log("Service Worker Registrato!"))
          .catch((err) => console.log("Errore SW:", err));
      }
    </script>
</body>
</html>







